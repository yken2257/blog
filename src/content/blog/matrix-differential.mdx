---
title: "行列の微分"
description: ""
pubDate: "July 26 2023"
---
import ExternalLink from '../../components/ExternalLink.astro';
export const components = {a: ExternalLink}

$m$次元ベクトル$\boldsymbol{x}=(x_1, x_2, \dots, x_m)$に対して、あるスカラー$L(\boldsymbol{x})$が定まっているとする。このとき、$\boldsymbol{x}$の各要素$x_i$についての偏微分をベクトルとしてまとめたものを
$$
\frac{\partial L}{\partial \boldsymbol{x}} = \left(\frac{\partial L}{\partial x_1}, \frac{\partial L}{\partial x_2}, \dots, \frac{\partial L}{\partial x_m}\right)
$$
と書く。

同様に、$m$行$n$列の行列$\boldsymbol{X}=(x_{ij})_{1 \leq i \leq m, 1 \leq j \leq n}$に対してあるスカラー$L(\boldsymbol{X})$が定まっているとする。このとき、$\boldsymbol{X}$の各要素$x_{ij}$についての偏微分を行列としてまとめたものを
$$
\begin{align}
\frac{\partial L}{\partial \boldsymbol{X}} &= \left(\frac{\partial L}{\partial x_{ij}}\right)_{1 \leq i \leq m, 1 \leq j \leq n} \\
&= \left(
\begin{array}{cccc}
\frac{\partial L}{\partial x_{11}} & \frac{\partial L}{\partial x_{12}} & \dots & \frac{\partial L}{\partial x_{1n}} \\
\frac{\partial L}{\partial x_{21}} & \frac{\partial L}{\partial x_{22}} & \dots & \frac{\partial L}{\partial x_{2n}} \\
\vdots & \vdots & \ddots & \vdots \\
\frac{\partial L}{\partial x_{m1}} & \frac{\partial L}{\partial x_{m2}} & \dots & \frac{\partial L}{\partial x_{mn}} \\
\end{array}
\right)
\end{align}
$$
と書く。

$m$次元の入力ベクトル$\boldsymbol{x}$があり、この線型結合により$n$次元の出力ベクトル$\boldsymbol{y}$が得られるとする。この時線型結合の重みを$m$行$n$列の行列$\boldsymbol{W}$で表すとすると、$\boldsymbol{y}$は

$$
\begin{align}
\boldsymbol{y} &= \boldsymbol{x}\cdot\boldsymbol{W} \\
&=  (x_1, x_2, \dots, x_m) \left(
\begin{array}{cccc}
w_{11} & w_{12} & \dots & w_{1n} \\
w_{21} & w_{22} & \dots & w_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
w_{m1} & w_{m2} & \dots & w_{mn} \\
\end{array}
\right) \\
&= (w_{11}x_1 + w_{21}x_2 + \dots + w_{m1}x_m,\ \dots,\ w_{1n}x_1 + w_{2n}x_2 + \dots + w_{mn}x_m)
\end{align}
$$

となる。次元としては、$\boldsymbol{x}$は$(1\times m)$次元、$\boldsymbol{W}$は$m \times n$次元、$\boldsymbol{y}$は$(1\times n)$次元となる。Pythonの配列shapeで表すと、$\boldsymbol{x}$は`(m,)`、$\boldsymbol{W}$は`(m, n)`、$\boldsymbol{y}$は`(n,)`となる。

最小化すべきスカラー量の目的関数$L(\boldsymbol{y})$があるとする。目的関数の値を最小化するためには、$\boldsymbol{y}$の各要素$y_i$についての偏微分が0になる必要がある。すなわち、

$$
\frac{\partial L}{\partial y_i} = 0
$$
